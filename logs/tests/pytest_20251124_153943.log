============================= test session starts =============================
platform win32 -- Python 3.11.9, pytest-8.4.1, pluggy-1.6.0 -- C:\Python311\python.exe
cachedir: .pytest_cache
PySide6 6.9.1 -- Qt runtime 6.9.1 -- Qt compiled 6.9.1
rootdir: F:\Programming\Apps\ShittyRandomPhotoScreenSaver
configfile: pytest.ini
plugins: qt-4.5.0
collecting ... collected 28 items

tests/test_transitions.py::test_transition_state_enum PASSED             [  3%]
tests/test_transitions.py::test_crossfade_creation PASSED                [  7%]
tests/test_transitions.py::test_crossfade_duration PASSED                [ 10%]
tests/test_transitions.py::test_crossfade_start_with_no_old_image PASSED [ 14%]
tests/test_transitions.py::test_crossfade_start_with_images PASSED       [ 17%]
tests/test_transitions.py::test_crossfade_signals PASSED                 [ 21%]
tests/test_transitions.py::test_crossfade_progress_range PASSED          [ 25%]
tests/test_transitions.py::test_crossfade_stop PASSED                    [ 28%]
tests/test_transitions.py::test_crossfade_cleanup PASSED                 [ 32%]
tests/test_transitions.py::test_crossfade_invalid_pixmap PASSED          [ 35%]
tests/test_transitions.py::test_crossfade_already_running PASSED         [ 39%]
tests/test_transitions.py::test_crossfade_easing_curves PASSED           [ 42%]
tests/test_transitions.py::test_crossfade_set_easing PASSED              [ 46%]
tests/test_transitions.py::test_crossfade_repr PASSED                    [ 50%]
tests/test_transitions.py::test_crossfade_state_transitions PASSED       [ 53%]
tests/test_transitions.py::test_crossfade_multiple_transitions PASSED    [ 57%]
tests/test_transition_integration.py::TestTransitionIntegration::test_crossfade_transition_runs PASSED [ 60%]
tests/test_transition_integration.py::TestTransitionIntegration::test_slide_transition_runs PASSED [ 64%]
tests/test_transition_integration.py::TestTransitionIntegration::test_diffuse_transition_runs PASSED [ 67%]
tests/test_transition_integration.py::TestTransitionIntegration::test_block_puzzle_flip_transition_runs PASSED [ 71%]
tests/test_transition_integration.py::TestTransitionIntegration::test_wipe_transition_runs PASSED [ 75%]
tests/test_transition_integration.py::TestTransitionIntegration::test_transition_cleanup_on_stop PASSED [ 78%]
tests/test_transition_integration.py::TestTransitionIntegration::test_transition_settings_respected FAILED [ 82%]
tests/test_transition_integration.py::TestTransitionIntegration::test_transition_fallback_on_error PASSED [ 85%]
tests/test_transition_integration.py::TestTransitionIntegration::test_random_slide_direction FAILED [ 89%]
tests/test_transition_integration.py::TestTransitionIntegration::test_diffuse_transition_software_backend_no_watchdog FAILED [ 92%]
tests/test_transition_integration.py::TestTransitionIntegration::test_block_flip_transition_software_backend_no_watchdog PASSED [ 96%]
tests/test_gl_prewarm.py::test_gl_prewarm_overlays_ready PASSED          [100%]QSettings: Failed to delete key "Software\Test\ScreensaverTest" (Illegal operation attempted on a registry key that has been marked for deletion.)
QSettings: Failed to delete key "Software\Test\ScreensaverTest" (Illegal operation attempted on a registry key that has been marked for deletion.)
QSettings: Failed to delete key "Software\Test\ScreensaverTest" (Illegal operation attempted on a registry key that has been marked for deletion.)
QSettings: Failed to delete key "Software\Test\ScreensaverTest" (Illegal operation attempted on a registry key that has been marked for deletion.)
QSettings: Failed to delete key "Software\Test\ScreensaverTest" (Illegal operation attempted on a registry key that has been marked for deletion.)
QSettings: Failed to delete key "Software\Test\ScreensaverTest" (Illegal operation attempted on a registry key that has been marked for deletion.)


================================== FAILURES ===================================
________ TestTransitionIntegration.test_transition_settings_respected _________

self = <tests.test_transition_integration.TestTransitionIntegration object at 0x0000023DE9FA6290>
qt_app = <PySide6.QtWidgets.QApplication(0x23de8240a90) at 0x0000023DE9FC07C0>
display_widget = <rendering.display_widget.DisplayWidget(0x23de7faa300) at 0x0000023DE9FC2180>
test_pixmap = <PySide6.QtGui.QPixmap(QSize(200, 200),depth=32,devicePixelRatio=1,cacheKey=0x5400000002) at 0x0000023DEA622A40>
test_pixmap2 = <PySide6.QtGui.QPixmap(QSize(200, 200),depth=32,devicePixelRatio=1,cacheKey=0x5500000002) at 0x0000023DEA621EC0>

    def test_transition_settings_respected(self, qt_app, display_widget, test_pixmap, test_pixmap2):
        """Test that transition settings are properly read and applied."""
        # Set specific settings
        self._set_transitions(
            display_widget.settings_manager,
            transition_type='Slide',
            duration_ms=750,
            slide_direction='Top to Bottom',
        )
    
        display_widget.set_image(test_pixmap, "test1.png")
        display_widget.set_image(test_pixmap2, "test2.png")
    
        # Verify transition was created with correct type
        if display_widget._current_transition:
>           assert type(display_widget._current_transition).__name__ == 'SlideTransition'
E           AssertionError: assert 'GLCompositorSlideTransition' == 'SlideTransition'
E             
E             - SlideTransition
E             + GLCompositorSlideTransition

tests\test_transition_integration.py:289: AssertionError
---------------------------- Captured Qt messages -----------------------------
QtWarningMsg: QSettings: Failed to delete key "Software\Test\ScreensaverTest" (Illegal operation attempted on a registry key that has been marked for deletion.)
---------------------------- Captured log teardown ----------------------------
WARNING  SettingsManager:settings_manager.py:617 All settings cleared
____________ TestTransitionIntegration.test_random_slide_direction ____________

self = <tests.test_transition_integration.TestTransitionIntegration object at 0x0000023DE9FA6F10>
qt_app = <PySide6.QtWidgets.QApplication(0x23de8240a90) at 0x0000023DE9FC07C0>
display_widget = <rendering.display_widget.DisplayWidget(0x23de8e5f360) at 0x0000023DE8887AC0>
test_pixmap = <PySide6.QtGui.QPixmap(QSize(200, 200),depth=32,devicePixelRatio=1,cacheKey=0x5c00000002) at 0x0000023DEA6C8740>
test_pixmap2 = <PySide6.QtGui.QPixmap(QSize(200, 200),depth=32,devicePixelRatio=1,cacheKey=0x5d00000002) at 0x0000023DEA6CBD80>

    def test_random_slide_direction(self, qt_app, display_widget, test_pixmap, test_pixmap2):
        """Test that random slide direction selection works."""
        self._set_transitions(
            display_widget.settings_manager,
            transition_type='Slide',
            duration_ms=500,
            slide_direction='Random',
        )
    
        display_widget.set_image(test_pixmap, "test1.png")
        display_widget.set_image(test_pixmap2, "test2.png")
    
        # Should have created a slide transition with random direction
        if display_widget._current_transition:
>           assert type(display_widget._current_transition).__name__ == 'SlideTransition'
E           AssertionError: assert 'GLCompositorSlideTransition' == 'SlideTransition'
E             
E             - SlideTransition
E             + GLCompositorSlideTransition

tests\test_transition_integration.py:322: AssertionError
---------------------------- Captured log teardown ----------------------------
WARNING  SettingsManager:settings_manager.py:617 All settings cleared
_ TestTransitionIntegration.test_diffuse_transition_software_backend_no_watchdog _
CALL ERROR: Exceptions caught in Qt event loop:
________________________________________________________________________________
Traceback (most recent call last):
  File "F:\Programming\Apps\ShittyRandomPhotoScreenSaver\rendering\gl_compositor.py", line 377, in <lambda>
    on_complete=lambda: self._on_slide_complete(on_finished),
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "F:\Programming\Apps\ShittyRandomPhotoScreenSaver\rendering\gl_compositor.py", line 687, in _on_slide_complete
    self.update()
RuntimeError: Internal C++ object (GLCompositorWidget) already deleted.
________________________________________________________________________________
Traceback (most recent call last):
  File "F:\Programming\Apps\ShittyRandomPhotoScreenSaver\rendering\gl_compositor.py", line 377, in <lambda>
    on_complete=lambda: self._on_slide_complete(on_finished),
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "F:\Programming\Apps\ShittyRandomPhotoScreenSaver\rendering\gl_compositor.py", line 687, in _on_slide_complete
    self.update()
RuntimeError: Internal C++ object (GLCompositorWidget) already deleted.
________________________________________________________________________________

---------------------------- Captured stderr call -----------------------------
Exceptions caught in Qt event loop:
________________________________________________________________________________
Traceback (most recent call last):
  File "F:\Programming\Apps\ShittyRandomPhotoScreenSaver\rendering\gl_compositor.py", line 377, in <lambda>
    on_complete=lambda: self._on_slide_complete(on_finished),
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "F:\Programming\Apps\ShittyRandomPhotoScreenSaver\rendering\gl_compositor.py", line 687, in _on_slide_complete
    self.update()
RuntimeError: Internal C++ object (GLCompositorWidget) already deleted.
________________________________________________________________________________
Exceptions caught in Qt event loop:
________________________________________________________________________________
Traceback (most recent call last):
  File "F:\Programming\Apps\ShittyRandomPhotoScreenSaver\rendering\gl_compositor.py", line 377, in <lambda>
    on_complete=lambda: self._on_slide_complete(on_finished),
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "F:\Programming\Apps\ShittyRandomPhotoScreenSaver\rendering\gl_compositor.py", line 687, in _on_slide_complete
    self.update()
RuntimeError: Internal C++ object (GLCompositorWidget) already deleted.
________________________________________________________________________________
---------------------------- Captured log teardown ----------------------------
WARNING  SettingsManager:settings_manager.py:617 All settings cleared
=========================== short test summary info ===========================
FAILED tests/test_transition_integration.py::TestTransitionIntegration::test_transition_settings_respected - AssertionError: assert 'GLCompositorSlideTransition' == 'SlideTransition'
  
  - SlideTransition
  + GLCompositorSlideTransition
FAILED tests/test_transition_integration.py::TestTransitionIntegration::test_random_slide_direction - AssertionError: assert 'GLCompositorSlideTransition' == 'SlideTransition'
  
  - SlideTransition
  + GLCompositorSlideTransition
FAILED tests/test_transition_integration.py::TestTransitionIntegration::test_diffuse_transition_software_backend_no_watchdog - Failed: CALL ERROR: Exceptions caught in Qt event loop:
________________________________________________________________________________
Traceback (most recent call last):
  File "F:\Programming\Apps\ShittyRandomPhotoScreenSaver\rendering\gl_compositor.py", line 377, in <lambda>
    on_complete=lambda: self._on_slide_complete(on_finished),
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "F:\Programming\Apps\ShittyRandomPhotoScreenSaver\rendering\gl_compositor.py", line 687, in _on_slide_complete
    self.update()
RuntimeError: Internal C++ object (GLCompositorWidget) already deleted.
________________________________________________________________________________
Traceback (most recent call last):
  File "F:\Programming\Apps\ShittyRandomPhotoScreenSaver\rendering\gl_compositor.py", line 377, in <lambda>
    on_complete=lambda: self._on_slide_complete(on_finished),
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "F:\Programming\Apps\ShittyRandomPhotoScreenSaver\rendering\gl_compositor.py", line 687, in _on_slide_complete
    self.update()
RuntimeError: Internal C++ object (GLCompositorWidget) already deleted.
________________________________________________________________________________
======================== 3 failed, 25 passed in 20.75s ========================
